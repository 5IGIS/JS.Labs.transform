/* labs!transform 0.6.0 */
function log(a){debugging&&console.log(a)}function sender(a){var b;if(!a)var a=window.event;return a.target?b=a.target:a.srcElement&&(b=a.srcElement),3==b.nodeType&&(b=b.parentNode),b}debugging=!0;var Point=Class.extend({construct:function(a,b){return"object"==typeof a&&null!=a?(this.x=a.x,void(this.y=a.y)):(this.x=a||0,void(this.y=b||0))},stringValue:function(){return"["+this.x+","+this.y+"]"}});Object.prototype.setValueForKeyPath_=function(value,keyPath){dot=null==keyPath||""==keyPath?"":".";var statement="this"+dot+keyPath+"=value;";eval(statement)},Object.prototype.valueForKeyPath_=function(keyPath){dot=null==keyPath||""==keyPath?"":".";var statement="this"+dot+keyPath;return eval(statement)},Object.prototype.setValueForKeyPath=function(value,keyPath){if(null!=keyPath&&""!=keyPath){var path=keyPath.replace(".",'"]["'),statement='this["'+path+'"]=value;';log("eval("+statement+")"),eval(statement)}},Object.prototype.valueForKeyPath=function(keyPath){if(null!=keyPath&&""!=keyPath){var path=keyPath.replace(".",'"]["'),statement='this["'+path+'"]';return log("eval("+statement+")"),eval(statement)}},Object.prototype.enumerate=function(a){for(eachKey in this)eachValue=this[eachKey],"function"!=typeof eachValue&&a(eachValue,eachKey)};var Defaults={defaultHeight:450,maxHeight:450,defaultWidth:450,maxWidth:450,defaultTop:20,maxTop:450,defaultLeft:20,maxLeft:450,defaultPerspective:1e4,maxPerspective:1e4,defaultRotate:0,maxRotate:360,defaultTranslate:0,maxTranslate:450,defaultOrigin:50,maxOrigin:100},defaultPropertyControls=[{key:"widthControl",name:"width",unit:"px",url:"http://www.w3schools.com/cssref/pr_dim_width.asp",title:"The width property sets the width of an element.",min:0,max:Defaults.maxWidth,value:Defaults.defaultWidth,delegate:null},{key:"heightControl",name:"height",unit:"px",url:"http://www.w3schools.com/cssref/pr_dim_height.asp",title:"The height property sets the height of an element.",min:0,max:Defaults.maxHeight,value:Defaults.defaultHeight,delegate:null},{key:"topControl",name:"top",unit:"px",url:"http://www.w3schools.com/cssref/pr_pos_top.asp",title:"For absolutely positioned elements, the top property sets the top edge of an element to a unit above/below the top edge of its containing element. For relatively positioned elements, the top property sets the top edge of an element to a unit above/below its normal position.",min:0,max:Defaults.maxTop,value:Defaults.defaultTop,delegate:null},{key:"leftControl",name:"left",unit:"px",url:"http://www.w3schools.com/cssref/pr_pos_left.asp",title:"For absolutely positioned elements, the left property sets the left edge of an element to a unit to the left/right of the left edge of its containing element. For relatively positioned elements, the left property sets the left edge of an element to a unit to the left/right to its normal position.",min:0,max:Defaults.maxLeft,value:Defaults.defaultLeft,delegate:null}],defaultPropertyValueControls={"-webkit-transform":[{key:"perspectiveControl",name:"perspective",unit:"",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a perspective view for a 3D transformed element",min:0,max:Defaults.maxPerspective,value:Defaults.defaultPerspective,className:"TransformValueControl",delegate:null},{key:"rotateXControl",name:"rotateX",unit:"deg",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a 3D rotation along the X-axis.",min:0,max:Defaults.maxRotate,value:Defaults.defaultRotate,className:"TransformValueControl",delegate:null},{key:"rotateYControl",name:"rotateY",unit:"deg",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a 3D rotation along the Y-axis.",min:0,max:Defaults.maxRotate,value:Defaults.defaultRotate,className:"TransformValueControl",delegate:null},{key:"rotateZControl",name:"rotateZ",unit:"deg",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a 3D rotation along the Z-axis.",min:0,max:Defaults.maxRotate,value:Defaults.defaultRotate,className:"TransformValueControl",delegate:null},{key:"translateXControl",name:"translateX",unit:"px",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a translation, using only the value for the X-axis.",min:0,max:Defaults.maxTranslate,value:Defaults.defaultTranslate,className:"TransformValueControl",delegate:null},{key:"translateYControl",name:"translateY",unit:"px",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a translation, using only the value for the X-axis.",min:0,max:Defaults.maxTranslate,value:Defaults.defaultTranslate,className:"TransformValueControl",delegate:null},{key:"translateZControl",name:"translateZ",unit:"px",url:"http://www.w3schools.com/css3/css3_3dtransforms.asp",title:"Defines a 3D translation, using only the value for the Z-axis.",min:0,max:Defaults.maxTranslate,value:Defaults.defaultTranslate,className:"TransformValueControl",delegate:null}],"-webkit-transform-origin":[{key:"originXControl",name:"originX",unit:"%",url:"http://www.w3schools.com/cssref/css3_pr_transform-origin.asp",title:"Set a rotated element's base placement.",min:0,max:Defaults.maxOrigin,value:Defaults.defaultOrigin,className:"PercentValueControl",delegate:null},{key:"originYControl",name:"originY",unit:"%",url:"http://www.w3schools.com/cssref/css3_pr_transform-origin.asp",title:"Set a rotated element's base placement.",min:0,max:Defaults.maxOrigin,value:Defaults.defaultOrigin,className:"PercentValueControl",delegate:null}]},TRPropertyControl=Class.extend({construct:function(a,b){this.parentPropertyName=b||"";var c=b?".":"";this.key=a.key,this.keyPath=this.parentPropertyName+c+this.key,this.name=a.name,this.unit=a.unit,this.url=a.url,this.title=a.title,this.min=a.min,this.max=a.max,this.step=a.step||1,this.value=a.value,this.delegate=a.delegate,this.valueTextField=null,this.element=this.createElement()},createElement:function(){var a=document.createElement("div");a.className="variable";var b=document.createElement("a");b.href=this.url,b.title=this.title,b.target="_blank";var c=document.createElement("label");c.className="name",c.innerHTML=this.name,this.slider=document.createElement("input"),this.slider.id=this.name+"Slider",this.slider.className="range",this.slider.type="range",this.slider.min=this.min,this.slider.max=this.max,this.slider.step=this.step,this.slider.value=this.value,this.slider.onchange=this.sliderValueChanged.bind(this),this.slider.onmouseup=this.sliderReleased.bind(this),this.slider.dataset.keyPath=this.keyPath,this.valueTextField=document.createElement("input"),this.valueTextField.id=this.name+"ValueTextField",this.valueTextField.className="value",this.valueTextField.value=this.value,this.valueTextField.onchange=this.valueTextField.onkeydown=this.valueTextField.onkeyup=this.textFieldValueChanged.bind(this),this.valueTextField.dataset.keyPath=this.keyPath;var d=document.createElement("label");return d.className="unit",d.innerHTML=this.unit,a.appendChild(b),b.appendChild(c),a.appendChild(this.slider),a.appendChild(this.valueTextField),a.appendChild(d),a},cssValue:function(){return this.name+": "+this.value+this.unit+";"},sliderValueChanged:function(a){slider=sender(a),log(slider.dataset.keyPath),control=viewController.controlForKeyPath(slider.dataset.keyPath),control.value=slider.value,control.valueTextField.value=slider.value,control.delegate.sliderValueChanged(a)},sliderReleased:function(a){slider=sender(a),control=viewController.controlForKeyPath(slider.dataset.keyPath),control.delegate.sliderReleased(a)},textFieldValueChanged:function(a){textField=sender(a),control=viewController.controlForKeyPath(textField.dataset.keyPath),control.value=textField.value,control.slider.value=textField.value,control.delegate.textFieldValueChanged(a)}}),TransformValueControl=TRPropertyControl.extend({cssValue:function(){return this.name+"("+this.value+this.unit+")"}}),PercentValueControl=TRPropertyControl.extend({cssValue:function(){return this.value+"%"}}),TRViewController=Class.extend({construct:function(){this.propertiesPanel=document.getElementById("propertiesPanel"),this.cssTextArea=document.getElementById("cssTextArea"),this.dummy=document.getElementById("dummy"),this.properyControls=[],this.cssText=""},build:function(){this.addPropertyControls(defaultPropertyControls),this.addPropertyValueControls(defaultPropertyValueControls),this.sliderValueChanged()},addNewPropertyControl:function(a){var b=a.className||"TRPropertyControl";control=new window[b](a),this.properyControls[control.keyPath]=control,this.propertiesPanel.appendChild(control.element)},addPropertyControls:function(a){a.enumerate(function(a){a.delegate=viewController,viewController.addNewPropertyControl(a)})},addNewPropertyValueControl:function(a,b){var c=b.className||"TRTRPropertyControl";control=new window[c](b,a),null==this.properyControls[a]&&(this.properyControls[a]=[]),this.properyControls.setValueForKeyPath(control,control.keyPath),this.propertiesPanel.appendChild(control.element)},addPropertyValueControls:function(a){a.enumerate(function(a,b){a.enumerate(function(a){a.delegate=viewController,viewController.addNewPropertyValueControl(b,a)})})},controlForKeyPath:function(a){return this.properyControls.valueForKeyPath(a)},cssRule:function(){var a="";return this.properyControls.enumerate(function(b,c){log("eachControlOrPropertyValues: "+b),b instanceof Array?(cssDefinition="",document.cssValues=[],b.enumerate(function(a){document.cssValues.push(a.cssValue())}),cssDefinition=document.cssValues.join(" "),a+=c+": "+cssDefinition+"; \n"):(eachControl=b,a+=eachControl.cssValue()+" \n")}),a},sliderValueChanged:function(){this.cssText=this.cssRule(),this.cssTextArea.value=this.cssText,this.apply()},sliderReleased:function(){},textFieldValueChanged:function(){this.cssText=this.cssRule(),this.cssTextArea.value=this.cssText,this.apply()},apply:function(){this.dummy.style.cssText=this.cssRule()}}),viewController=new TRViewController;viewController.build();